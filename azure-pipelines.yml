# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '10.x'
  displayName: 'Install Node.js'

- script: |
    npm install
    npm run build
  displayName: 'npm install and build'

- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
      $emailFrom = "sarthakpokhrel8@example.com"
      $emailTo = "sarthakpokhrel3@gmail.com"
      $smtpServer = "smtp.gmail.com"  # Replace with your SMTP server address
      $smtpUsername = "your.smtp.username"  # Replace with your SMTP username (if required)
      $smtpPassword = "your.smtp.password"  # Replace with your SMTP password (if required)

      $subject = "Azure Pipeline Build $(if($env:Build_Status -eq 'Succeeded') {'Succeeded'} else {'Failed'})"
      $body = "The build for branch $(Build.SourceBranch) in pipeline $(System.DefinitionName) has $(if($env:Build_Status -eq 'Succeeded') {'succeeded'} else {'failed'})."

      # Create mail message
      $mailMessage = New-Object System.Net.Mail.MailMessage($emailFrom, $emailTo, $subject, $body)

      # Create SMTP client
      $smtp = New-Object Net.Mail.SmtpClient($smtpServer)
      $smtp.Send($mailMessage)
      
  condition: always()
